#!/usr/bin/env python

import sunburnt
import logging
import hashlib
import sys


def indexDocsToSolr(docs,indexingOptions):
    solrURL = indexingOptions['solrURL']
    archiveID = indexingOptions['archiveID']
    collectionID = indexingOptions['collID']
    solr_instance = sunburnt.SolrInterface(solrURL)
    solrDocs = []
    if len(docs) > 0:
        for html_id,doc in docs:
            solr_doc = {"id":html_id, "content":doc, "collection_type":collType, "collection_id":archiveID, "event":event, "event_type":eventType} 
            solr_instance.add(solrDocs)
    
        try:
            solr_instance.commit()
        except:
            print "Could not Commit Changes to Solr, check the log files."
            logging.info("Could not Commit Changes to Solr, check the log files.")
        else:
            print "Successfully committed changes"
            logging.info("Successfully committed changes")
    else:
        print "No documents to index"
        


def uploadToSolr(relfile):
    f = open (relfile, 'r')
    i = 0
    title = None
    url = None
    doc = None
    docList = []
    z = 0

    for line in f:
        if i % 2 == 0:
            try:
                title,_,url = line.strip().split("\t")
            except Exception as e:
                _,url = line.strip().split("\t")
                title = eventName
                print line.strip()
                z += 1
        else:
            doc = line.strip()
            docList.append((url,title,doc))
            doc = None
            url = None
            title = None
        i += 1

    print "Len doclist : " , len(docList)
    solrKeys = {}
    solrKeys['solrURL'] = "http://nick.dlib.vt.edu:8983/solr/blacklight-core"
    solrKeys['Type'] = "Tweets"
    solrKeys['collID'] = archiveID
    indexDocsToSolr(docList,solrKeys)
    f.close()
    print z

if __name__ == "__main__":
    #relfile = sys.argv[1].strip()
    relfile = "C:\\Users\\Michael\\Documents\\VT 2016\\Hypertext\\z163-1000.json"

    uploadToSolr(relfile)
